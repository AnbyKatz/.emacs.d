Module pyplots
  use Kinds
  implicit none

  INTERFACE plot  
     MODULE PROCEDURE plot, plot_notitle,plot2,plot2_notitle &
          ,plot3,plot3_notitle
  END INTERFACE

contains
  
  !---------------------------------------------------------------------!
  !                                                                     !
  !                           Plotting Routine                          !
  !                                                                     !
  !---------------------------------------------------------------------!

  subroutine plot(x,xaxis,yaxis)
    use Kinds
    implicit none
    real(DP),dimension(:,:),intent(in) :: x
    character(len=*),intent(in)        :: xaxis,yaxis
    character(len=9)                   :: fmt
    integer                            :: ii,j,N

    N = size(x,dim=2)
    
    open(100,file="titles.dat",action="write", &
         & status="replace",form="formatted")        
    open(101,file="output.dat",action="write", &
         & status="replace",form="formatted")

    write(100,'(2a15)') xaxis
    write(100,'(2a15)') yaxis
    write(fmt,'(a1,i1,a7)') '(', N, 'es20.9)'

    do ii=1,size(x,dim=1)
       write(101,fmt) x(ii,:)
    end do

    close(100)
    close(101)

    call system("./pyplots.py")

  end subroutine plot

  subroutine plot_notitle(x,y)
    use Kinds
    implicit none
    real(DP),dimension(:),intent(in) :: x,y
    integer :: i
    
    if (size(x) .ne. size(y)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if
    
    open(100,file="title.dat",action="write", &
         & status="replace",form="formatted")        
    open(101,file="output.dat",action="write", &
         & status="replace",form="formatted")

    write(100,'(a)') " "

    do i=1,size(x)
       write(101,'(2es20.5)') x(i),y(i)
    end do

    close(100)
    close(101)

    call system("./pyplots.py")

  end subroutine plot_notitle

  subroutine plot2(x,y,z,w,title)
    use Kinds
    implicit none
    real(DP),dimension(:),intent(in) :: x,y,z,w
    character(len=*),intent(in)     :: title
    integer :: i
    
    if (size(x) .ne. size(y)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if

    if (size(z) .ne. size(w)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if
    
    open(100,file="title.dat",action="write", &
         & status="replace",form="formatted")        
    open(101,file="output.dat",action="write", &
         & status="replace",form="formatted")

    write(100,'(a)') title

    do i = 1,size(x)
       write(101,'(4es20.5)') x(i), y(i), z(i), w(i)
    end do

    close(100)
    close(101)

    call system("./pyplots.py")

  end subroutine plot2

  subroutine plot2_notitle(x,y,z,w)
    use Kinds
    implicit none
    real(DP),dimension(:),intent(in) :: x,y,z,w
    integer :: i
    
    if (size(x) .ne. size(y)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if

    if (size(z) .ne. size(w)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if
    
    open(100,file="title.dat",action="write", &
         & status="replace",form="formatted")        
    open(101,file="output.dat",action="write", &
         & status="replace",form="formatted")

    write(100,'(a)') " "

    do i = 1,size(x)
       write(101,'(4es20.5)') x(i), y(i), z(i), w(i)
    end do

    close(100)
    close(101)

    call system("./pyplots.py")

  end subroutine plot2_notitle

  subroutine plot3(x,y,z,w,k,v,title)
    use Kinds
    implicit none
    real(DP),dimension(:),intent(in) :: x,y,z,w,k,v
    character(len=*),intent(in)     :: title
    integer :: i
    
    if (size(x) .ne. size(y)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if

    if (size(z) .ne. size(w)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if

    if (size(k) .ne. size(v)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if
    
    open(100,file="title.dat",action="write", &
         & status="replace",form="formatted")        
    open(101,file="output.dat",action="write", &
         & status="replace",form="formatted")

    write(100,'(a)') title

    do i = 1,size(x)
       write(101,'(6es20.5)') x(i), y(i), z(i), w(i), k(i), v(i)
    end do

    close(100)
    close(101)

    call system("./pyplots.py")

  end subroutine plot3

  subroutine plot3_notitle(x,y,z,w,k,v)
    use Kinds
    implicit none
    real(DP),dimension(:),intent(in) :: x,y,z,w,k,v
    integer :: i
    
    if (size(x) .ne. size(y)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if

    if (size(z) .ne. size(w)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if

    if (size(k) .ne. size(v)) then
       print *, "ERROR! sizes of arrays not equal"
       return
    end if
    
    open(100,file="title.dat",action="write", &
         & status="replace",form="formatted")        
    open(101,file="output.dat",action="write", &
         & status="replace",form="formatted")

    write(100,'(a)') " "

    do i = 1,size(x)
       write(101,'(6es20.5)') x(i), y(i), z(i), w(i), k(i), v(i)
    end do
    
    close(100)
    close(101)

    call system("./pyplots.py")

  end subroutine plot3_notitle

end Module pyplots
